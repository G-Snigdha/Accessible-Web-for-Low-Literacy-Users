<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Accessible Text Reader - Making Text Easy to Read</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .card-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .card-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .card-body {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .text-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            border: 3px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .text-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .example-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .example-btn {
            padding: 8px 16px;
            background: #f8fafc;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .example-btn:hover {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .feature-options {
            background: #f8fafc;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .option-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .option-label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 140px;
            font-size: 1rem;
        }

        .option-select {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .option-select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 25px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-height: 120px;
        }

        .feature-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .feature-btn:active {
            transform: translateY(-1px);
        }

        .feature-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feature-icon {
            font-size: 2rem;
        }

        .feature-text {
            text-align: center;
        }

        .results-section {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            overflow: hidden;
            display: none;
        }

        .results-section.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-header h3 {
            font-size: 1.5rem;
            margin: 0;
        }

        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .results-content {
            padding: 30px;
        }

        .result-tabs {
            display: flex;
            border-bottom: 2px solid #e1e8ed;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #4facfe;
            border-bottom-color: #4facfe;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .result-text {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            font-size: 1.1rem;
            line-height: 1.7;
            border-left: 4px solid #4facfe;
            margin-bottom: 20px;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: #4facfe;
            color: white;
        }

        .action-btn.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 2px solid #e2e8f0;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .status-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-message.error {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-message.success {
            background: #dcfce7;
            color: #16a34a;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e1e8ed;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #22c55e;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #ef4444;
        }

        .toast.warning {
            background: #f59e0b;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .card-body {
                padding: 20px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .result-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìö Accessible Text Reader</h1>
            <p>Transform complex text into clear, easy-to-read content with powerful AI features</p>
        </div>

        <!-- Main Input Card -->
        <div class="main-card">
            <div class="card-header">
                <h2>‚ú® Enter Your Text</h2>
                <p>Paste or type any text you want to make more accessible</p>
            </div>
            <div class="card-body">
                <div class="input-section">
                    <label class="input-label" for="main-text-input">
                        üìù Your Text (paste here or try an example)
                    </label>
                    <textarea 
                        id="main-text-input" 
                        class="text-input" 
                        placeholder="Paste your text here, or click one of the example buttons below to get started..."
                    ></textarea>
                    
                    <div class="example-buttons">
                        <button class="example-btn" onclick="loadExample(1)">üìö Academic Text</button>
                        <button class="example-btn" onclick="loadExample(2)">üì∞ News Article</button>
                        <button class="example-btn" onclick="loadExample(3)">üíº Business Email</button>
                        <button class="example-btn" onclick="loadExample(4)">üî¨ Technical Guide</button>
                    </div>
                </div>

                <!-- Feature Options -->
                <div class="feature-options">
                    <div class="option-group">
                        <label class="option-label">üéØ Simplify Mode:</label>
                        <select id="simplify-mode" class="option-select">
                            <option value="basic">Basic - Common words</option>
                            <option value="moderate">Moderate - More changes</option>
                            <option value="advanced">Advanced - Comprehensive</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label class="option-label">üåç Translate to:</label>
                        <select id="translate-language" class="option-select">
                            <option value="spanish">Spanish (Espa√±ol)</option>
                            <option value="french">French (Fran√ßais)</option>
                            <option value="german">German (Deutsch)</option>
                            <option value="italian">Italian (Italiano)</option>
                            <option value="portuguese">Portuguese (Portugu√™s)</option>
                        </select>
                    </div>
                </div>

                <div class="feature-grid">
                    <button class="feature-btn" onclick="processText('simplify')" id="simplify-btn">
                        <div class="feature-icon">üéØ</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Simplify Text</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Make complex words easier to understand</div>
                        </div>
                    </button>

                    <button class="feature-btn" onclick="processText('translate')" id="translate-btn">
                        <div class="feature-icon">üåç</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Translate Text</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Convert to different languages</div>
                        </div>
                    </button>

                    <button class="feature-btn" onclick="processText('analyze')" id="analyze-btn">
                        <div class="feature-icon">üìä</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Analyze Text</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Get readability insights</div>
                        </div>
                    </button>

                    <button class="feature-btn" onclick="readAloud()" id="read-btn">
                        <div class="feature-icon">üîä</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Read Aloud</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Listen to your text</div>
                        </div>
                    </button>

                    <button class="feature-btn" onclick="processText('proofread')" id="proofread-btn">
                        <div class="feature-icon">‚úèÔ∏è</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Proofread</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Fix grammar and spelling</div>
                        </div>
                    </button>

                    <button class="feature-btn" onclick="processText('rewrite')" id="rewrite-btn">
                        <div class="feature-icon">üìù</div>
                        <div class="feature-text">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">Rewrite</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Improve clarity and flow</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results-section">
            <div class="results-header">
                <h3 id="results-title">üéâ Results</h3>
                <button class="close-btn" onclick="hideResults()">√ó</button>
            </div>
            <div class="results-content">
                <div class="result-tabs">
                    <button class="tab-btn active" onclick="showTab('result')" id="result-tab">üìÑ Result</button>
                    <button class="tab-btn" onclick="showTab('comparison')" id="comparison-tab">üîÑ Comparison</button>
                    <button class="tab-btn" onclick="showTab('analysis')" id="analysis-tab">üìä Analysis</button>
                </div>

                <div class="tab-content active" id="result-content">
                    <div class="result-text" id="result-text">
                        Your processed text will appear here...
                    </div>
                    <div class="result-actions">
                        <button class="action-btn primary" onclick="copyResult()">
                            üìã Copy Text
                        </button>
                        <button class="action-btn secondary" onclick="readResult()">
                            üîä Read Aloud
                        </button>
                        <button class="action-btn secondary" onclick="downloadResult()">
                            üíæ Download
                        </button>
                    </div>
                </div>

                <div class="tab-content" id="comparison-content">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="margin-bottom: 15px; color: #64748b;">üì§ Original Text</h4>
                            <div class="result-text" id="original-text">Original text will appear here...</div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: #64748b;">üì• Processed Text</h4>
                            <div class="result-text" id="processed-text">Processed text will appear here...</div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="analysis-content">
                    <div id="analysis-details">
                        Analysis details will appear here...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'http://localhost:3001';
        let currentResult = null;
        let isProcessing = false;

        // Example texts
        const examples = {
            1: "The implementation of sustainable environmental initiatives necessitates collaborative engagement from governmental entities, commercial enterprises, and individual stakeholders to ameliorate the deleterious effects of anthropogenic climate transformation.",
            2: "Following comprehensive analysis of market conditions and consumer behavior patterns, the organization has determined to implement a strategic restructuring initiative to optimize operational efficiency and enhance competitive positioning.",
            3: "Please be advised that pursuant to our previous correspondence regarding the aforementioned contractual obligations, we require immediate confirmation of your participation in the scheduled meeting to facilitate proper coordination of all relevant stakeholders.",
            4: "The utilization of advanced computational algorithms in conjunction with machine learning methodologies enables the optimization of complex data processing workflows, thereby facilitating enhanced predictive analytics capabilities."
        };

        // Utility functions
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        function loadExample(num) {
            const textInput = document.getElementById('main-text-input');
            textInput.value = examples[num];
            textInput.focus();
            showToast(`üìö Example ${num} loaded! Try a feature button now.`);
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.disabled = loading;
                if (loading) {
                    button.style.opacity = '0.6';
                } else {
                    button.style.opacity = '1';
                }
            }
        }

        function showResults(title) {
            const resultsSection = document.getElementById('results-section');
            const resultsTitle = document.getElementById('results-title');
            resultsTitle.textContent = title;
            resultsSection.classList.add('show');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function hideResults() {
            document.getElementById('results-section').classList.remove('show');
        }

        function showTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Add active class to selected tab and content
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        async function processText(action) {
            const textInput = document.getElementById('main-text-input');
            const text = textInput.value.trim();

            if (!text) {
                showToast('‚ö†Ô∏è Please enter some text first!', 'warning');
                textInput.focus();
                return;
            }

            if (isProcessing) {
                showToast('‚è≥ Please wait for the current operation to complete', 'warning');
                return;
            }

            isProcessing = true;
            const buttonId = `${action}-btn`;
            setButtonLoading(buttonId, true);

            try {
                // Get options based on action
                const options = {};
                if (action === 'simplify') {
                    options.mode = document.getElementById('simplify-mode').value;
                } else if (action === 'translate') {
                    options.language = document.getElementById('translate-language').value;
                }

                showToast(`‚è≥ Processing text with ${action}...`);

                const response = await fetch(`${API_BASE}/api/text/process`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        action: action,
                        options: options,
                        language: 'en'
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    currentResult = data.data;
                    displayResults(action, data.data);
                    
                    // Show success message with details
                    let successMessage = `‚úÖ ${action} completed successfully!`;
                    if (action === 'simplify') {
                        const mode = options.mode || 'basic';
                        successMessage = `‚úÖ Text simplified using ${mode} mode!`;
                    } else if (action === 'translate') {
                        const lang = options.language || 'spanish';
                        successMessage = `‚úÖ Text translated to ${lang}!`;
                    }
                    showToast(successMessage);
                } else {
                    throw new Error(data.error || 'Processing failed');
                }

            } catch (error) {
                console.error('Processing error:', error);
                showToast(`‚ùå ${action} failed: ${error.message}`, 'error');
            } finally {
                isProcessing = false;
                setButtonLoading(buttonId, false);
            }
        }

        function displayResults(action, data) {
            // Update result text
            document.getElementById('result-text').textContent = data.processed_text || 'No result available';
            
            // Update comparison
            document.getElementById('original-text').textContent = data.original_text || 'No original text';
            document.getElementById('processed-text').textContent = data.processed_text || 'No processed text';

            // Update analysis if available
            const analysisDiv = document.getElementById('analysis-details');
            if (action === 'analyze' && data.analysis) {
                const analysis = data.analysis;
                analysisDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="result-text">
                            <h4 style="margin-bottom: 10px;">üìä Reading Level</h4>
                            <p><strong>Grade:</strong> ${analysis.reading_level?.grade || 'N/A'}</p>
                            <p><strong>Level:</strong> ${analysis.reading_level?.level || 'N/A'}</p>
                            <p><strong>Description:</strong> ${analysis.reading_level?.description || 'N/A'}</p>
                        </div>
                        <div class="result-text">
                            <h4 style="margin-bottom: 10px;">üìà Statistics</h4>
                            <p><strong>Word Count:</strong> ${analysis.word_count || 0}</p>
                            <p><strong>Sentences:</strong> ${analysis.sentence_count || 0}</p>
                            <p><strong>Avg Length:</strong> ${analysis.avg_sentence_length || 0} words/sentence</p>
                        </div>
                        <div class="result-text">
                            <h4 style="margin-bottom: 10px;">üéØ Complexity</h4>
                            <p><strong>Score:</strong> ${analysis.complexity_score || 0}%</p>
                            <p><strong>Sentiment:</strong> ${analysis.sentiment || 'neutral'}</p>
                        </div>
                        ${analysis.difficult_words?.length ? `
                        <div class="result-text">
                            <h4 style="margin-bottom: 10px;">üî§ Difficult Words</h4>
                            <p>${analysis.difficult_words.join(', ')}</p>
                        </div>` : ''}
                        ${analysis.readability_notes?.length ? `
                        <div class="result-text">
                            <h4 style="margin-bottom: 10px;">üí° Recommendations</h4>
                            <ul>
                                ${analysis.readability_notes.map(note => `<li>${note}</li>`).join('')}
                            </ul>
                        </div>` : ''}
                    </div>
                `;
            } else {
                analysisDiv.innerHTML = '<div class="result-text">No analysis data available for this operation.</div>';
            }

            // Show results with appropriate title
            const titles = {
                simplify: 'üéØ Text Simplified',
                translate: 'üåç Text Translated',
                analyze: 'üìä Text Analysis',
                proofread: '‚úèÔ∏è Text Proofread',
                rewrite: 'üìù Text Rewritten'
            };
            showResults(titles[action] || 'üéâ Results');
        }

        async function readAloud() {
            const textInput = document.getElementById('main-text-input');
            const text = textInput.value.trim();

            if (!text) {
                showToast('‚ö†Ô∏è Please enter some text to read aloud!', 'warning');
                textInput.focus();
                return;
            }

            if (!('speechSynthesis' in window)) {
                showToast('‚ùå Text-to-speech not supported in your browser', 'error');
                return;
            }

            try {
                // Cancel any ongoing speech
                speechSynthesis.cancel();

                showToast('üîä Starting to read text...');
                setButtonLoading('read-btn', true);

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;

                // Wait for voices to load
                const voices = speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const englishVoice = voices.find(voice => voice.lang.startsWith('en'));
                    if (englishVoice) {
                        utterance.voice = englishVoice;
                    }
                }

                utterance.onstart = () => {
                    showToast('üîä Reading text aloud...');
                };

                utterance.onend = () => {
                    showToast('‚úÖ Finished reading!');
                    setButtonLoading('read-btn', false);
                };

                utterance.onerror = (event) => {
                    showToast(`‚ùå Speech error: ${event.error}`, 'error');
                    setButtonLoading('read-btn', false);
                };

                speechSynthesis.speak(utterance);

            } catch (error) {
                showToast(`‚ùå Failed to read text: ${error.message}`, 'error');
                setButtonLoading('read-btn', false);
            }
        }

        function copyResult() {
            if (!currentResult) {
                showToast('‚ö†Ô∏è No result to copy', 'warning');
                return;
            }

            const text = currentResult.processed_text || '';
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('üìã Text copied to clipboard!');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('üìã Text copied to clipboard!');
            } catch (err) {
                showToast('‚ùå Failed to copy text', 'error');
            }
            document.body.removeChild(textArea);
        }

        function readResult() {
            if (!currentResult) {
                showToast('‚ö†Ô∏è No result to read', 'warning');
                return;
            }

            if (!('speechSynthesis' in window)) {
                showToast('‚ùå Text-to-speech not supported', 'error');
                return;
            }

            const text = currentResult.processed_text || '';
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.onstart = () => showToast('üîä Reading result...');
            utterance.onend = () => showToast('‚úÖ Finished reading result!');
            utterance.onerror = () => showToast('‚ùå Failed to read result', 'error');
            
            speechSynthesis.speak(utterance);
        }

        function downloadResult() {
            if (!currentResult) {
                showToast('‚ö†Ô∏è No result to download', 'warning');
                return;
            }

            const text = currentResult.processed_text || '';
            const blob = new Blob([text], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `processed-text-${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('üíæ File downloaded!');
        }

        // Initialize voices when page loads
        window.addEventListener('load', () => {
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
                speechSynthesis.addEventListener('voiceschanged', () => {
                    console.log('Voices loaded:', speechSynthesis.getVoices().length);
                });
            }
        });

        // Test server connection when page loads
        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                if (response.ok) {
                    console.log('‚úÖ Backend server connected successfully');
                } else {
                    showToast('‚ö†Ô∏è Backend server connection issue', 'warning');
                }
            } catch (error) {
                showToast('‚ùå Cannot connect to backend server. Please check if it\'s running.', 'error');
                console.error('Backend connection error:', error);
            }
        });
    </script>
</body>
</html>